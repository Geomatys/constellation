<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:c="http://java.sun.com/jstl/core"
                xmlns:a4j="http://richfaces.org/a4j"
                xmlns:mf="http://mapfaces.org/taglib"
                template="/pages/base.xhtml">

    <ui:param name="pageTitle" value="#{providerBean.i18n['provider_overview_title']}"/>

    <ui:define name="content">

        <!-- layer providers -->
        <h:panelGroup>
            <h3>#{providerBean.i18n['provider_overview_layers']}</h3>
            <h:commandButton action="#{providerBean.reloadLayerProviders}" value="Force reload"/>
            <br/>
            <br/>
            <div class="rounded">
            <mf:Outline id="layerPreview" value="#{providerBean.layerModel}" var="node" width="100%" rootVisible="false"
                        rowStyler="#{mf:constant('org.constellation.bean.HighLightRowStyler.INSTANCE')}">

                <h:column>
                    <f:facet name="header"><mf:CustomHtml tag="span" ><h:outputText value=""/></mf:CustomHtml></f:facet>

                    <mf:switch>
                        <mf:case condition="#{mf:isInstance(node.userObject,'ProviderService')}" fallthrought="false">
                            <h:outputText value="#{node.userObject.name}"/>
                        </mf:case>
                        <mf:case condition="#{mf:isInstance(node.userObject,'Provider')}" fallthrought="false">
                            <h:outputText value="#{node.userObject.id}"/>
                        </mf:case>
                        <mf:case condition="#{mf:isInstance(node.userObject,'LayerDetails')}" fallthrought="false">
                            <h:outputText value="#{node.userObject.name.localPart}"/>
                        </mf:case>
                        <mf:default>
                            <h:outputText value="#{node.userObject}"/>
                        </mf:default>
                    </mf:switch>

                </h:column>

                <mf:DataTableColumn>
                    <f:facet name="header"><mf:CustomHtml tag="span" ><h:outputText value="Style"/></mf:CustomHtml></f:facet>

                    <mf:switch>
                        <mf:case condition="#{mf:isInstance(node.userObject,'LayerDetails')}" fallthrought="false">
                            <h:outputText value="#{node.userObject.favoriteStyles}"/>
                        </mf:case>
                    </mf:switch>

                </mf:DataTableColumn>

                <mf:DataTableColumn width="16">
                    <f:facet name="header"><mf:CustomHtml tag="span" ><h:outputText value="View"/></mf:CustomHtml></f:facet>

                    <mf:switch>
                        <mf:case condition="#{mf:isInstance(node.userObject,'LayerDetails')}" fallthrought="false">

                            <a4j:commandLink action="#{providerBean.show}" reRender="dialogContent" oncomplete="dlg4.show();">
                                <f:param name="currentNodeId" value="#{layerPreview.nodeIndex}" />
                                <h:graphicImage value="org.constellation.menu.provider.view.png.mfRes" style="border:none;"/>

                            </a4j:commandLink>


                        </mf:case>
                    </mf:switch>

                </mf:DataTableColumn>


            </mf:Outline>
            </div>
            
        </h:panelGroup>

        <!-- style providers -->
        <h:panelGroup>
            <h3>#{providerBean.i18n['provider_overview_styles']}</h3>
            <h:commandButton action="#{providerBean.reloadStyleProviders}" value="Force reload"/>
            <br/>
            <br/>
            <div class="rounded">
            <mf:Outline id="stylePreview" value="#{providerBean.styleModel}" var="node" width="100%" rootVisible="false"
                        rowStyler="#{mf:constant('org.constellation.bean.HighLightRowStyler.INSTANCE')}">

                <h:column>
                    <f:facet name="header"><mf:CustomHtml tag="span" ><h:outputText value=""/></mf:CustomHtml></f:facet>

                    <mf:switch>
                        <mf:case condition="#{mf:isInstance(node.userObject,'ProviderService')}" fallthrought="false">
                            <h:outputText value="#{node.userObject.name}"/>
                        </mf:case>
                        <mf:case condition="#{mf:isInstance(node.userObject,'Provider')}" fallthrought="false">
                            <h:outputText value="#{node.userObject.id}"/>
                        </mf:case>
                        <mf:default>
                            <h:outputText value="#{node.userObject}"/>
                        </mf:default>
                    </mf:switch>

                </h:column>

            </mf:Outline>
            </div>
        </h:panelGroup>


        <mf:dialog  id="dialog4" header="Preview" widgetVar="dlg4"
                    width="650" height="430" modal="true"
                    showEffect="fade" hideEffect="fade">
            <mf:Div id="dialogContent">
                <mf:Context id="context" service="/resources/context/empty.xml">
                    <table>
                        <colgroup>
                            <col width="50" />
                            <col width="500" />
                        </colgroup>
                        <tbody>
                            <tr>
                                <td>
                                    <mf:LayerControl id="tree" deleteColumn="true" displayMode="tree"
                                                     style="float:left;width:150px;" width="150px" />
                                </td>
                                <td>
                                    <mf:ButtonBar id="buttonbar" defaultToolName="pan" zoomBoxOut="true" history="false"></mf:ButtonBar>
                                    <mf:MapPane id="mappane" value="#{providerBean.mapContext}" style="width:450px;"></mf:MapPane>
                                </td>
                            </tr>
                        </tbody>
                    </table>


                </mf:Context>
            </mf:Div>
        </mf:dialog>


    </ui:define>

</ui:composition>
