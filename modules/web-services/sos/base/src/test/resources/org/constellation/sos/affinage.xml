<?xml version="1.0" encoding="UTF-8"?>
<query name="ObservationAffinage">


-- ===== SELECT =====


<select group="filterObservation">
    <col>
        <var>name</var>
        <sql>"name"</sql>
    </col>
</select>

<select group="filterResult">
    <col>
        <var>result</var>
        <sql>"result"</sql>
    </col>
    <col>
        <var>sampling_time_begin</var>
        <sql>"sampling_time_begin"</sql>
    </col>
    <col>
        <var>sampling_time_end</var>
        <sql>"sampling_time_end"</sql>
    </col>
</select>

-- ==== FROM ========

<from group="observations">"observation"."observations"</from>
<from group="measurements">"observation"."measurements"</from>

-- ==== WHERE =======

<where group="observationType">"name" LIKE '%:${observationIdBase}%'</where>

-- ==== PROCEDURE (capteur) =======

<where group="procedure">"procedure"=:${procedure}</where>

-- ==== PHENOMENON ===========

<where group="simplePhenomenon">"observed_property"=:${phenomenon}</where>
<where group="compositePhenomenon">"observed_property_composite"=:${phenomenon}</where>

-- ==== FEATURE OF INTEREST (station)=============

<where group="foi">"feature_of_interest_point"=:${foi} OR "feature_of_interest_curve"=:${foi}</where>

-- ==== TIME BEFORE ======== 
<where group="tbefore"><![CDATA["sampling_time_begin"<=:${time}]]></where>

-- ===== TIME AFTER ========
<where group="tafter"><![CDATA[("sampling_time_begin">=:${time}) OR ("sampling_time_begin"<=:${time} AND "sampling_time_end">=:${time})]]></where>


-- ===== TIME DURING ========
<where group="tduring"><![CDATA[("sampling_time_begin">=:${begin} AND "sampling_time_end"<= :${end}) OR ("sampling_time_begin">=:${begin} AND "sampling_time_begin"<=:${end} AND "sampling_time_end" IS NULL) OR   ("sampling_time_begin"<=:${begin} AND "sampling_time_end"<= :${end} AND "sampling_time_end">= :${begin}) OR ("sampling_time_begin">=:${begin} AND "sampling_time_end">= :${end} AND "sampling_time_begin"<= :${end}) OR
("sampling_time_begin"<=:${begin} AND "sampling_time_end">= :${end})]]></where>


-- ===== TIME EQUALS TimePeriod========
<where group="tequalsTP"><![CDATA["sampling_time_begin"=:${begin} AND "sampling_time_end"=:${end}]]></where>

-- ===== TIME EQUALS TimeInstant========
<where group="tequalsTI"><![CDATA[("sampling_time_begin"=:${position} AND "sampling_time_end" IS NULL) OR ("sampling_time_begin"<=:${position} AND "sampling_time_end">=:${position})]]></where>

</query>